# terraces
C++ data checker for the existence of terraces in phylogenetic tree space.

**Usage**: `terraces/build/release/app <nwk file> <gene/site file>`

Program output states some imput data properties, the species whose leaf edge is used as a new tree root, and the resulting supertree in enhanced newick format. (STILL SUBJECT TO CHANGE!)

**Enhanced Newick Format**: The resulting supertree representation cann be plain Newick, but can also contain the following two notation enhancements:
- `{a,b,c}` represents any conceivable binary subtree comprising the taxa a, b, and c.
- `(A|B,C|D)` represents any conceivable binary subtree comprising either subtrees A or B on the left, and either subtrees C or D on the right branch.

Both enhancements were chosen such that the result is standard newick format if there's only one possible supertree.

## Improvements and Optimizations

### Implemented:

- We introduced an optional, **compressed tree output format**. This format makes printing to terminal faster, since not all possible trees are listed in full detail. See section *Enhanced Newick Format* above. [https://git.scc.kit.edu/bioinfo2017/terraces/issues/8]
- **Memory allocation in large blocks**, and managing them with free lists. [https://git.scc.kit.edu/bioinfo2017/terraces/issues/37]
- **Deletion of unnecessary constraints**. [https://git.scc.kit.edu/bioinfo2017/terraces/issues/23]
- **Improved data structures**: We replaced index vectors representing the current leaves by bitvectors with rank support, thus improving space requirements and the efficiency of constraint filtering. The union-find data structure could be improved by storing the set ranks in out-of-bounds indices, thus halving the storage. [https://git.scc.kit.edu/bioinfo2017/terraces/issues/29]
- **Remap constraints**: By removing inner nodes from the constraint numbering, we were able to halve the space requirements of most of our data structures. [https://git.scc.kit.edu/bioinfo2017/terraces/issues/21]
- **Use specialized bit manipulation instructions**: Bipartition iteration and bitvector operations (bit iteration and rank computation) were improved significantly by using specialized CPU instructions supported by Compiler intrinsics.
- **Provide a fast terrace check**: We discovered that checking for the existence of multiple trees on a terrace can be done without explicitly building any of these trees, thus decreasing the runtime even further.
- **Implemented validation methods**: For checking whether the trees generated by our algorithm are indeed distinct and equivalent to the input tree with respect to the missing data, we implemented a fast isomorphy check operating directly on our data structures.
- Since we wanted to implement different versions of the algorithm, we used a **generic enumerator** which relies on callback methods to implement the concrete version of the algorithm (terrace checking, tree counting or multitree construction). This method also allows us to attach **logging and status update decorators** to the algorithm to check the internal computations or monitor the progress of the algorithm.
- Short of support for arbitrary-precision math, our implementation is **fully compatible with Visual C++** in addition to the normal gcc/clang support.

### Planned:

- Enumerate subtrees in **parallel**. One challenge would be separation of the workload so that multiple threads have "enough to do". Another challenge would be the merging of the individual threads' results. [https://git.scc.kit.edu/bioinfo2017/terraces/issues/6]
- Finding **good heuristics** for choosing a subtree into which we want to descend first. Ideally, we'd have a nice heuristic that tells us which subtrees and associated constraints probably give us several options to construct a supertree, in which case we can safely answer "yes" to the question "are we on a terrace?". **Ideas**: "Smallest subtree first", "Least constraints first". [https://git.scc.kit.edu/bioinfo2017/terraces/issues/3]
- ...
